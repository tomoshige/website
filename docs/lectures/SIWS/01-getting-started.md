# Python でのデータサイエンス入門

Pythonでデータ探索を始める前に、理解しておくべき重要な概念がいくつかあります：

1. Python と Google Colab とは何か？
2. Pythonでのコーディング方法
3. Pythonライブラリとは何か？

これらの概念については、続く章で紹介します。もしこれらの概念にある程度馴染みがあれば、[データセット探索](#explore-datasets)の章に進んでください。そこでは2023年にニューヨーク市（NYC）の主要3空港から出発した国内線フライトのデータセットを紹介します。このデータセットは本書の多くの部分で詳しく探索していきます。

## Python と Google Colab とは？

本書では、Python を Google Colab で使用することを前提としています。初心者はこの二つを混同することがありますが、最も単純に言えば、Python は車のエンジンのようなもので、Google Colab は車のダッシュボードのようなものです。

![Python と Google Colab の違いの類似](https://i.imgur.com/8KUzHvg.png)

より正確に言えば、Python はコンピュテーションを実行するプログラミング言語であり、Google Colab は便利な機能やツールを追加することでインターフェースを提供する*統合開発環境（IDE）*です。スピードメーター、バックミラー、ナビゲーションシステムが運転を容易にするように、Google Colab のインターフェースは Python の使用を格段に簡単にします。

### Python と Google Colab の準備

Google Colab はブラウザベースの環境で、特別なインストールは必要ありません。以下の手順で始めることができます：

1. Google アカウントにログインします
2. [Google Colab](https://colab.research.google.com/) にアクセスします
3. 「新しいノートブック」を選択します

Google Colab では、コードと文書（マークダウン）を含む「セル」を作成できます。コードセルで Python コードを実行し、結果を直接確認できます。

## Python でのコーディング方法

R や Excel、SPSS、Minitab などの[ポイント＆クリック](https://en.wikipedia.org/wiki/Point_and_click)インターフェースを持つ統計ソフトウェアとは異なり、Python は[インタープリター言語](https://en.wikipedia.org/wiki/Interpreted_language)です。つまり、*Python コード*で書かれたコマンドを入力する必要があります。言い換えれば、Python でのコーディング/プログラミングが必要になります。なお、本書では「コーディング」と「プログラミング」という用語を互換的に使用します。

Python を使うために熟練したプログラマーである必要はありませんが、新しい Python ユーザーが理解すべき基本的なプログラミング概念があります。したがって、本書はプログラミングの本ではありませんが、データを効果的に探索・分析するために必要な基本的なプログラミング概念について学びます。

### 基本的なプログラミング概念と用語

ここでは基本的なプログラミング概念と用語を紹介します。これらの概念や用語をすべて暗記するのではなく、実際に「学びながら」理解できるようにガイドします。理解を助けるために、通常のテキストと`コンピュータコード`を区別するために異なるフォントを常に使用します。これらのトピックを習得する最良の方法は、Python を[意図的に練習](https://jamesclear.com/deliberate-practice-theory)し、繰り返し使用することです。

* 基本：
    + *コードの実行*：コンソールでコマンドを入力して Python に操作を実行させること。
    + *オブジェクト*：Python で値が保存される場所。オブジェクトに値を*代入*する方法とオブジェクトの内容を表示する方法を学びます。
    + *データ型*：整数、浮動小数点数、論理値、文字列など。整数は -1, 0, 2, 4092 のような値です。浮動小数点数（または数値）は整数を含むより大きな値の集合で、-24.932 や 0.8 のような小数や分数の値も含みます。論理値は `True` または `False` で、文字列は "キャベツ"、"ハミルトン"、"The Wire は史上最高のテレビ番組"、"このラーメンはおいしい" などのテキストです。なお、文字列は通常引用符で囲まれます。
* *リスト*：値の配列。Python では `[6, 11, 13, 31, 90, 92]` のように角括弧を使用して作成します。
* *データフレーム*：長方形の表形式データ。Python では pandas ライブラリを使って扱います。行は*観測値*に対応し、列は観測値を記述する*変数*に対応します。データフレームについては[データセット探索](#explore-datasets)で詳しく説明します。
* *条件式*：
  + Python での等価性の確認は `==` を使用します（代入に使用される `=` ではありません）。例えば、`2 + 1 == 3` は `2 + 1` を `3` と比較する正しい Python コードであり、`2 + 1 = 3` はエラーを返します。
  + ブール代数：`True/False` 文と `<`（より小さい）、`<=`（以下）、`!=`（等しくない）などの数学的演算子。例えば、`4 + 2 >= 3` は `True` を返しますが、`3 + 5 <= 1` は `False` を返します。
  + 論理演算子：「かつ」を表す `and` と「または」を表す `or`。例えば、`(2 + 1 == 3) and (2 + 1 == 4)` は両方の句が `True` ではないため（最初の句のみが `True`）、`False` を返します。一方、`(2 + 1 == 3) or (2 + 1 == 4)` は少なくとも1つの句が `True` であるため、`True` を返します。
* *関数*：Python ではタスクを実行する関数があります。関数は*引数*と呼ばれる入力を受け取り、出力を返します。関数の引数を手動で指定するか、関数の*デフォルト値*を使用することができます。
  + 例えば、Python の `range()` 関数は数字の範囲を生成します。引数なしで `range(5)` を実行すると、0から4までの連続した整数リストを表すrange型のオブジェクトが返されます。これは `list(range(5))` として `[0, 1, 2, 3, 4]` のリストを得ることができます。デフォルトでは、`range(start, stop)` は `start` が 0 からカウントを始めます。この動作を変更するには、`range(2, 5)` のように `start` と `stop` に異なる値を渡します。これにより `[2, 3, 4]` が得られます。
  + 本書では多くの関数を扱い、その動作を理解するための練習を多く行います。関数に言及するときは、`range()` のように後ろに `()` を付けて表記します。

これはPythonユーザーになるために必要なすべてのプログラミング概念と用語を網羅したリストではありません。そのようなリストは非常に大きくなり、特に初心者には役立ちません。むしろ、これは始める前に知っておく必要がある最小限のプログラミング概念と用語のリストだと考えています。残りは進めながら学ぶことができます。すべての概念と用語の習得は、練習を重ねるにつれて向上します。

### エラー、警告、メッセージ

新しい Python ユーザーを intimidate するものの一つは、*エラー*、*警告*、*メッセージ*の報告方法です。これらを理解することが重要です。

Python では、以下の3つの異なる状況でコンソールにメッセージが表示されます：

* **エラー**：コードが実行できない場合、「Error:」または例外名（例：`ValueError`、`TypeError`など）で始まるメッセージが表示され、何が問題かを説明しようとします。エラーが発生すると、通常コードは実行されません。
* **警告**：コードは実行されるが、問題がある可能性がある場合、「Warning:」で始まるメッセージが表示されます。一般的に、いくつかの制約はありますが、コードは引き続き機能します。
* **メッセージ**：「Error」や「Warning」で始まらないテキストは、*単なる親切なメッセージ*です。これらのメッセージはライブラリをインポートするときや、CSVファイルを読み込むときに表示されることがあります。これらは役立つ診断メッセージであり、コードの実行を妨げるものではありません。

コンソールにメッセージが表示されても、*パニックにならないでください*。必ずしも何か問題があるわけではありません。

* テキストが「Error」で始まる場合は、何が原因かを突き止めてください。**エラーは赤信号のようなものです：何かが間違っています！**
* テキストが「Warning」で始まる場合は、心配すべきかどうかを判断してください。例えば、散布図に欠損値があるという警告が表示され、欠損値があることがわかっている場合は問題ありません。それが予想外の場合は、データを確認して何が欠けているかを確認してください。**警告は黄色の信号のようなものです：すべては正常に動作していますが、注意/留意してください。**
* それ以外の場合、テキストは単なるメッセージです。それを読み、Python に挨拶を返し、話しかけてくれたことに感謝してください。**メッセージは青信号のようなものです：すべては正常に動作しており、そのまま続けてください！**

### コーディングを学ぶためのヒント

コーディング/プログラミングを学ぶことは、外国語を学ぶことによく似ています。最初は大変で挫折することがあります。そのような挫折は一般的で、学習中に落胆を感じるのは正常なことです。しかし、外国語を学ぶのと同様に、努力を惜しまず、間違いを恐れなければ、誰でも学び、向上することができます。

プログラミングを学ぶ際に心に留めておくべきいくつかの有用なヒントを紹介します：

* **コンピュータは実際にはそれほど賢くないことを覚えておく**：コンピュータやスマートフォンが「賢い」と思うかもしれませんが、実際には人々が「賢く」見えるようにデザインするために多くの時間とエネルギーを費やしています。実際には、コンピュータに必要なことをすべて指示する必要があります。さらに、コンピュータに与える指示にはミスがあってはならず、またあいまいであってはなりません。
* **「コピー、ペースト、微調整」のアプローチを取る**：特に最初のプログラミング言語を学ぶときや、特に複雑なコードを理解する必要があるときは、一からコードを入力するよりも、既存の動作するコードを取得して目的に合わせて修正する方が簡単なことが多いです。これを*「コピー、ペースト、微調整」*アプローチと呼びます。そのため、初めのうちはコードを記憶から書こうとするのではなく、提供されている既存の例を取得し、コピー、ペースト、微調整して目標に合わせることをお勧めします。自信がついてきたら、このアプローチから徐々に離れ、一からコードを書くことができます。「コピー、ペースト、微調整」アプローチは、子供が自転車に乗ることを学ぶための補助輪のようなものです。慣れてくると、それらはもう必要なくなります。
* **コーディングを学ぶ最良の方法は実践すること**：その場しのぎにコーディングを学ぶよりも、目標を持っているときや特定のプロジェクトに取り組んでいるとき、例えば興味があり重要なデータを分析するときに、コーディングを学ぶ方がスムーズに進むことがわかります。
* **練習が鍵**：外国語のスキルを向上させる唯一の方法が多くの練習と会話であるように、コーディングスキルを向上させる唯一の方法も多くの練習です。心配しないでください。十分な練習の機会を提供します！

## Pythonライブラリとは？

新しいPythonユーザーによく混乱するのが、Pythonライブラリの概念です。Pythonライブラリは追加の関数、データ、ドキュメントを提供することで、Pythonの機能を拡張します。これらは世界中のPythonユーザーのコミュニティによって書かれ、インターネットから無料でダウンロードできます。

例えば、本書で使用する多くのライブラリの中には、データ可視化のための`matplotlib`と`seaborn`ライブラリ、データ操作のための`pandas`ライブラリ、そして本書に付随するデータや資料を含むPythonモジュールなどがあります。

Pythonライブラリの良い類似例は、携帯電話にダウンロードできるアプリのようなものです：

![PythonとPythonライブラリの類似](https://i.imgur.com/JmqJASm.png)

つまり、Pythonは新しい携帯電話のようなものです：初めて使用するときにある程度の機能がありますが、すべての機能があるわけではありません。Pythonライブラリは、Apple AppStoreやAndroid Google Playからダウンロードできるアプリのようなものです。

この類似を続けて、写真を編集してInstagramで友人と共有したいとします。新しい電話を購入した場合、次のことが必要です：

1. *アプリをインストールする*：新しい電話にはInstagramアプリが含まれていないので、App StoreまたはGoogle Playからアプリをダウンロードする必要があります。これを1回行えば、当面は設定完了です。将来、アプリのアップデートがある場合には再度行う必要があるかもしれません。
1. *アプリを開く*：Instagramをインストールした後、それを開く必要があります。

電話でInstagramが開いたら、写真を友人や家族と共有することができます。Pythonライブラリの使用プロセスも非常に似ています：

1. *ライブラリをインストールする*：これは電話にアプリをインストールするようなものです。ほとんどのライブラリはPythonをインストールするときにデフォルトではインストールされません。そのため、ライブラリを初めて使用する場合は、まずインストールする必要があります。ライブラリをインストールしたら、新しいバージョンにアップデートしたい場合を除いて、おそらく再度インストールすることはありません。
1. *ライブラリを「インポート」する*：ライブラリの「インポート」は、電話でアプリを開くようなものです。ライブラリはコンピュータでGoogle Colabを起動するときにデフォルトでは「インポート」されません。Google Colabを起動するたびに、使用したい各ライブラリを「インポート」する必要があります。

データ可視化のための`matplotlib`ライブラリでこれら2つのステップを実行してみましょう。

### ライブラリのインストール

> **Google Colabについての注意**: Google Colabでは、多くの一般的なライブラリが事前にインストールされています。ただし、一部のライブラリは追加でインストールが必要な場合があります。

Google Colabでライブラリをインストールするには、コードセルに`!pip install`コマンドを使用します。例えば、`matplotlib`ライブラリをインストールするには：

```python
!pip install matplotlib
```

コードセルでこのコマンドを実行し、Enterキーを押します。Google Colabは`matplotlib`ライブラリをインストール（または既にインストールされていることを確認）します。

同様に、以下のコマンドを実行して、`pandas`や`seaborn`などの他のライブラリもインストールできます：

```python
!pip install pandas seaborn
```

### ライブラリのインポート

ライブラリをインストールした後、それを「インポート」する必要があります。つまり、それを「開く」必要があります。これは`import`コマンドを使用して行います。

例えば、`matplotlib`ライブラリをインポートするには、コンソールで次のコードを実行します。「コードを実行する」とはどういう意味ですか？コードをコンソールに入力するか、コピーして貼り付け、Enterキーを押すことを意味します。

```python
import matplotlib.pyplot as plt
```

コードを実行した後、次のセルでブリンキングカーソルが表示される場合、成功し、`matplotlib`ライブラリがインポートされ、使用する準備ができています。ただし、`ModuleNotFoundError: No module named 'matplotlib'`のような赤い「エラーメッセージ」が表示された場合、正常にインストールされなかったことを意味します。このエラーメッセージが表示された場合は、[ライブラリのインストール](#library-installation)に戻り、進む前に`matplotlib`ライブラリをインストールしてください。

同様に、`pandas`と`seaborn`ライブラリもインポートしましょう：

```python
import pandas as pd
import seaborn as sns
```

### ライブラリの使用

新しいPythonユーザーがよく犯す非常によくある間違いの1つは、特定のライブラリを使用したいときに、最初に`import`コマンドを使用してインポートするのを忘れることです。覚えておいてください：*Google Colabを起動するたびに、使用したい各ライブラリをインポートする必要があります。*最初にライブラリを「インポート」せずに、その機能を使用しようとすると、次のようなエラーメッセージが表示されます：

```
NameError: name 'plt' is not defined
```

これは、ライブラリがまだインストールされていないというエラーメッセージとは異なります。Pythonは、インポートされていないライブラリの関数を使用しようとしていることを伝えています。Pythonは使用している関数がどこにあるのかわかりません。ほぼすべての新規ユーザーが最初にこれを忘れてしまい、慣れるまでは少し面倒かもしれません。しかし、練習すれば覚えられ、しばらくすると自然と身につくでしょう。

## 最初のデータセットを探索する

これまで学んだことをすべて実践に移して、実際のデータを探索し始めましょう！データはさまざまな形式で提供されます。本書では、「スプレッドシート」型の形式で保存されたデータセットに焦点を当てます。これはおそらく多くの分野でデータが収集され保存される最も一般的な方法です。[プログラミング概念](#programming-concepts)から、これらの「スプレッドシート」型のデータセットは、Pythonでは_データフレーム_と呼ばれることを覚えておいてください。本書では、データフレームとして保存されたデータの操作に焦点を当てます。

まず、この章に必要なライブラリをすべてインポートしましょう。ライブラリのインストール方法とインポート方法については、[Pythonライブラリとは？](#libraries)を参照してください。

```python
import pandas as pd
import numpy as np
```

本書の後続のすべての章では、その章のPythonコードを使用するためにインストールしてインポートする必要があるライブラリのリストを常に提供します。

### フライトデータセット

多くの人が飛行機で旅行したことがあるか、飛行機で旅行したことがある人を知っています。航空旅行は多くの人々の生活の中でますます存在感を増しています。空港の出発フライト情報ボードを見ると、いくつかのフライトがさまざまな理由で遅延していることがよくあります。フライトの遅延の原因となる理由を理解する方法はあるでしょうか？

私たちは皆、可能な限り目的地に時間通りに到着したいと思っています（空港でぶらぶらするのが密かに好きでない限り。もしあなたがこのような人なら、最終目的地にいることを大いに期待していると一瞬想像してください）。本書を通して、2023年にニューヨーク市の3つの主要空港の1つから出発するすべての国内線に関連するデータを分析します：ニューアーク・リバティ国際空港（EWR）、ジョン・F・ケネディ国際空港（JFK）、そしてラガーディア空港（LGA）です。

このようなデータはいくつか異なるソースから入手できますが、わかりやすさのために、GitHubから直接データをダウンロードして使用します。それでは、フライトデータを読み込んでみましょう：

```python
# GitHub上のデータURLを設定
flights_url = "https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/flights.csv"

# pandasを使用してデータを読み込む
flights = pd.read_csv(flights_url)

# 航空会社コードと名前のデータも読み込む
airlines_url = "https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/airlines.csv"
airlines = pd.read_csv(airlines_url)

# 空港データを読み込む
airports_url = "https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/airports.csv"
airports = pd.read_csv(airports_url)

# 天気データを読み込む
weather_url = "https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/weather.csv"
weather = pd.read_csv(weather_url)

# 飛行機のデータを読み込む
planes_url = "https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/planes.csv"
planes = pd.read_csv(planes_url)
```

上記のコードでは、`pd.read_csv()`関数を使って複数のデータフレームを読み込みました：

* `flights`: すべてのフライトに関する情報。
* `airlines`: 航空会社名と2文字の国際航空運送協会（IATA）航空会社コード（キャリアコードとも呼ばれる）を対応させる表。例えば、「DL」はデルタ航空の2文字コードです。
* `planes`: 使用される各物理的航空機に関する情報。
* `weather`: 3つのNYC空港それぞれの毎時気象データ。
* `airports`: 国内目的地の名前、コード、場所。

### `flights`データフレーム

`flights`データフレームを探索し、その構造を把握しましょう。次のコードをコンソールで実行してください。タイプするか、切り取ってコンソールに貼り付けます。これにより、`flights`データフレームの内容がコンソールに表示されます。モニターのサイズによって、出力は若干異なる場合があります。

```python
flights.head()
```

この出力を詳しく見てみましょう：

* ここには、異なる*観測値*に対応する行がいくつか表示されています。ここでは、各観測値は1つのフライトです。
* `year`、`month`、`day`、`dep_time`、`sched_dep_time`、`dep_delay`、および`arr_time`は、このデータセットの異なる列、つまり異なる変数です。
* この表示では、最初の5行の観測値のプレビューが表示されており、これは最初の5つのフライトに対応しています。Pythonは最初の5行のみを表示しています。なぜなら、すべての行を表示するとあなたの画面が圧倒されてしまうからです。
* データフレームの全体サイズを確認するには、`.shape`属性を使用できます：

```python
flights.shape
```

これにより、行数と列数が表示されます。

残念ながら、この出力ではデータをよく探索することはできませんが、良いプレビューが得られます。データフレームを探索するためのいくつかの異なる方法を見てみましょう。

### データフレームの探索 {#exploredataframes}

`flights`のようなデータフレームに含まれるデータを把握するためのさまざまな方法があります。データフレームを入力（引数）として取る3つの関数と、データフレームの1つの列を探索するための4番目の方法を紹介します：

1. `info()`メソッドを使用して、各列のデータ型と非欠損値の数を表示する。
2. `describe()`メソッドを使用して、数値列の要約統計量を表示する。
3. 表形式で整形されたデータを表示する方法。
4. 列名を使用して単一の変数にアクセスする方法。

**1. `info()`**:

Google Colabでコンソールに`flights.info()`を入力するか、貼り付けて実行します。データフレームを入手したら、それを確認する習慣をつけるべきです。

```python
flights.info()
```

**2. `describe()`**:

```python
flights.describe()
```

これにより、数値データ列の要約統計量が表示されます。

**3. 表形式で整形されたデータ**:

航空会社のデータを表形式で表示する方法を2つ見てみましょう。コンソールで次の2行のコードを実行してください：

```python
# デフォルト表示
airlines.head()

# より読みやすい表示のためにpandas display optionsを設定
pd.set_option('display.max_rows', None)
airlines
```

一見すると、出力にあまり違いがないように見えるかもしれませんが、2つ目のコードではすべての行が表示されます。レポートを作成する際には、より読みやすく読者に優しい出力形式を選ぶことが重要です。

**4. 列アクセス演算子**

最後に、Pythonでは列名を使用してデータフレームの単一の変数を抽出して探索することができます：

```python
# 航空会社名の列にアクセス
airlines['name']
```

これにより、長さ16のシリーズが返されます。データフレームを探索する際には、この列アクセス演算子を時々使用しますが、主に`info()`と`describe()`メソッドを使用します。

### 識別変数と測定変数 {#identification-vs-measurement-variables}

データフレームで遭遇する変数には、微妙な違いがあります。*識別変数*と*測定変数*があります。例えば、`airports.head()`の出力を調べてみましょう：

```python
airports.head()
```

変数`faa`と`name`は、各空港を一意に識別する*識別変数*です。`faa`は空港の一意のFAAコードを提供し、`name`はその正式名称を提供します。これらの変数は、データフレーム内の各行を一意に識別するために使用されます。残りの変数（`lat`、`lon`、`alt`、`tz`、`dst`、`tzone`）は、しばしば*測定*または*特性*変数と呼ばれます：各観測単位のプロパティを説明する変数です。例えば、`lat`と`long`は各空港の緯度と経度を記述します。

さらに、時には1つの変数だけでは各観測単位を一意に識別するのに十分でないことがあります：変数の組み合わせが必要な場合があります。絶対的なルールではありませんが、組織的な目的のために、識別変数をデータフレームの左端の列に配置することは良い習慣と考えられています。

### ヘルプ情報の確認方法

Pythonのもう一つの優れた機能は、さまざまな関数やデータセットのドキュメントを提供するヘルプ機能です。関数やメソッドについての情報を取得するには、`help()`関数を使用するか、Jupyter環境では関数名の末尾に`?`を追加して実行します。例えば、`pandas`の`read_csv`関数についてのヘルプを見てみましょう：

```python
help(pd.read_csv)
# または
# pd.read_csv?
```

ヘルプ情報がGoogle Colabの出力セルに表示されます。Pythonパッケージに含まれる関数について質問がある場合は、ヘルプファイルをすぐに調べる習慣をつけるべきです。

## 結論

この章では、Pythonでデータを探索するための基本的なツールセットを提供しましたが、網羅的ではありません。すべてを含めると、役立つよりも圧倒してしまうでしょう。ツールボックスに追加する最良の方法は、Google Colabでできるだけ多くのコードを実行し、書くことです。

### 追加リソース

プログラミング、Python、Google Colabの世界に初めて触れる方で、より詳細な入門書が必要と感じる場合は、オンラインで利用可能なリソースをいくつか紹介します：

1. [Python for Data Science Handbook](https://jakevdp.github.io/PythonDataScienceHandbook/) - Jake VanderPlas著
2. [Real Python](https://realpython.com/) - Pythonの入門から高度なトピックまでのチュートリアル
3. [Google Colabの公式チュートリアル](https://colab.research.google.com/notebooks/intro.ipynb)

これらのリソースには、フォローして一時停止できるスクリーンキャストが含まれています。また、再現可能な研究のためのツールであるJupyterノートブックの紹介も含まれています。

### 今後の内容

次は、図に示すように、第2章「データの可視化」で「Python + pandas + matplotlib/seabornによるデータサイエンス」の部分に進みます。データサイエンティストのツールボックスで最も重要なツールの1つであるデータ可視化に進みます。引き続き、データ可視化のための`matplotlib`と`seaborn`ライブラリを使用して、インポートしたデータを探索していきます。データ可視化は、`info()`と`describe()`メソッドが提供できる以上の洞察を提供するデータ探索のための強力なツールをツールボックスに追加します。