# 講義7: ガウスの消去法と解の探索

## 1. 本日扱う内容について（概要）
- **目的:**  
  - 連立一次方程式の行列表現と拡大係数行列の作成方法を学ぶ  
  - 行列の基本変形（行の入れ替え、定数倍、他の行の定数倍の加減）を理解する  
  - ガウスの消去法による連立一次方程式の解法を、拡大係数行列の変形という視点から習得する  
  - ガウスの消去法が、従来の消去法（式の足し算・引き算による消去）と本質的に同じであることを対応付けて理解する  
  - Google Colab を使った実装例で、操作の流れと解の探索のプロセスを体感する

- **講義の流れ:**  
  1. 連立一次方程式の行列表現と拡大係数行列の導入  
  2. 行列の基本変形の説明  
  3. ガウスの消去法による解法の具体的操作フロー（前進消去と後退代入）  
  4. ガウスの消去法と従来の消去法の対応づけ  
  5. ChatGPTによる解説＋Google Colabでの実装例  
  6. 学んだ内容の応用例  
  7. 演習問題

---

## 2. 扱う内容の理論の説明（定義・定理・数式を含む）

### 連立一次方程式の行列表現と拡大係数行列
- **定義:**  
  未知数 $x_1, x_2, \dots, x_n$ に対して、$m$ 本の一次方程式が同時に成立する連立一次方程式は、
  $$
  \begin{cases}
  a_{11} x_1 + a_{12} x_2 + \cdots + a_{1n} x_n = b_1, \\\
  a_{21} x_1 + a_{22} x_2 + \cdots + a_{2n} x_n = b_2, \\\
  \quad\vdots \\\
  a_{m1} x_1 + a_{m2} x_2 + \cdots + a_{mn} x_n = b_m.
  \end{cases}
  $$
- **拡大係数行列:**  
  この連立方程式は、係数行列 $A$ と定数項ベクトル $\mathbf{b}$ を並べて、
  $$
  [A \,|\, \mathbf{b}] = \begin{pmatrix}
  a_{11} & a_{12} & \cdots & a_{1n} & | & b_1 \\\
  a_{21} & a_{22} & \cdots & a_{2n} & | & b_2 \\\
  \vdots & \vdots & \ddots & \vdots & | & \vdots \\\
  a_{m1} & a_{m2} & \cdots & a_{mn} & | & b_m
  \end{pmatrix}
  $$
  と表し、これに対して基本変形を施していきます。

### 行列の基本変形
- **行の入れ替え:** 行の順序を変更する  
- **行の定数倍:** 行全体をゼロでない定数で乗じる  
- **行の加減:** ある行に、別の行の定数倍を加える（または引く）

### ガウスの消去法による解法の操作フロー
- **前進消去 (Forward Elimination):**  
  拡大係数行列に対して、上から順に各ピボット行を選び、ピボット列の下の成分を基本変形で 0 にする。
- **後退代入 (Back Substitution):**  
  上三角行列（または階段形）になったら、下から順に既に求めた未知数を使って解を計算する。

### ガウスの消去法と従来の消去法の対応づけ
- 従来の「足し算・引き算による消去法」は、各式を手作業で操作して変数を消していく方法でした。  
- ガウスの消去法では、この操作を拡大係数行列に対して体系的に行うため、手順が明確になり、後退代入によって解が求めやすくなります。

---

## 3. 扱う内容の例（実例を提示、GPT, Colabなどは利用しない）
### 例題：3変数の連立一次方程式
対象の連立一次方程式：
$$
\begin{cases}
(1)\quad 3x + y + z = -5, \\\
(2)\quad 4x + 3y - z = -2, \\\
(3)\quad 5x + 4y + z = 6.
\end{cases}
$$

#### ① 拡大係数行列の作成
初期の拡大係数行列は：
$$
\left[\begin{array}{ccc|c}
3 & 1 & 1 & -5 \\\
4 & 3 & -1 & -2 \\\
5 & 4 & 1 & 6
\end{array}\right]
$$

#### ② ガウスの消去法による操作フロー（従来の消去法の手順と対応）
1. **Step 1: 第1行の $x$ の係数が1になるように基本操作を行う**  
   - **従来の消去法の説明:**  
     まず、(2)式から(1)式を引いて、$x$ の係数が 1 の式（$x + 2y - 2z = 3$）を作る。  
   - **拡大係数行列での操作:**  
     - 拡大係数行列の(2)行を、新たな (2) 行として作るために、  
       (2)行 ← (2)行 − (1)行  
       $$
       (4-3,\; 3-1,\; -1-1,\; -2 - (-5)) = (1,\; 2,\; -2,\; 3).
       $$
     - 行列は次のように変化します：
       $$
       \left[\begin{array}{ccc|c}
       3 & 1 & 1 & -5 \\\
       1 & 2 & -2 & 3 \\\
       5 & 4 & 1 & 6
       \end{array}\right]
       $$
   - 次に、(2)行と(1)行の位置を入れ替え、最上行の $x$ の係数を 1 にする：
       $$
       \left[\begin{array}{ccc|c}
       1 & 2 & -2 & 3 \\\
       3 & 1 & 1 & -5 \\\
       5 & 4 & 1 & 6
       \end{array}\right]
       $$

2. **Step 2: 第1列の第1行目以外の係数を0にする**  
   - **目的:** 第二行と第三行から、$x$ の項を消す。  
   - **操作:**  
     - 第二行 ← 第二行 − 3×(第一行)  
       $$
       (3-3\cdot1,\; 1-3\cdot2,\; 1-3\cdot(-2),\; -5-3\cdot3) = (0,\; -5,\; 7,\; -14).
       $$
     - 第三行 ← 第三行 − 5×(第一行)  
       $$
       (5-5\cdot1,\; 4-5\cdot2,\; 1-5\cdot(-2),\; 6-5\cdot3) = (0,\; -6,\; 11,\; -9).
       $$
   - 結果、拡大係数行列は：
       $$
       \left[\begin{array}{ccc|c}
       1 & 2 & -2 & 3 \\\
       0 & -5 & 7 & -14 \\\
       0 & -6 & 11 & -9
       \end{array}\right]
       $$

3. **Step 3: 第2列の $y$ の係数を1にする**  
   - **操作:**  
     - まず、第二行のピボットを 1 にするため、第3行を第2行に加える
       $$
        (0,\; 1,\; -4,\; -5).
       $$
   - 拡大係数行列は、現段階で：
       $$
       \left[\begin{array}{ccc|c}
       1 & 2 & -2 & 3 \\\
       0 & 1 & -4 & -5 \\\
       0 & -6 & 11 & -9
       \end{array}\right]
       $$
    - 次に、第2列の第3行を`0`にするために、第3行に、第2行の6倍を加える
        $$
       \left[\begin{array}{ccc|c}
       1 & 2 & -2 & 3 \\\
       0 & 1 & -4 & -5 \\\
       0 & 0 & -13 & -39
       \end{array}\right]
       $$

4. **Step 4: 第3列の第3行の係数を`1`にする**  
   - **操作:**  
     - 第3行を 13 で割る。
       $$
       \left[\begin{array}{ccc|c}
       1 & 2 & -2 & 3 \\\
       0 & 1 & -4 & -5 \\\
       0 & 0 & 1 & 3
       \end{array}\right]
       $$
     - **後退代入:**  
       - 第三行より：$z = 3$.  
       - 第二行より：$ y - 4z = -5 $ から $y$ を求める。  
       - 第一行より：$ x + 2y - 2z = 3 $ から $x$ を求める.

このガウスの消去法によって得られた行列は、下の行に進むにつれて`1`のある列が後ろ側にずれていっている。言い換えると、ある行で、`0`以外の数字が出現する最初の列に着目すると、その数字より下の行は`0`となっている。このような行列を「**階段行列**」と呼ぶ。階段行列については、次の授業で詳しく扱う。

---

## 4. ChatGPTによる解説＋Google Colab での実行例

### ChatGPTによる解説
- ガウスの消去法では、まず拡大係数行列を作成し、各行の先頭に現れる変数の係数（ピボット）を 1 に整えます。  
- その後、ピボット行の定数倍を使って、下部の同じ列の成分を 0 にしていくことで、上三角行列（または階段形）に変形します。  
- 実際に手計算では、うまく計算して`1`を作りましたが、コンピュータでは`1`を作るのは先頭の数字で割ればよいので、次のように計算できます。

以下のコードは、連立一次方程式
$$
\begin{cases}
3x + y + z = -5, \\\
4x + 3y - z = -2, \\\
5x + 4y + z = 6,
\end{cases}
$$
に対して、拡大係数行列を使い、ガウスの消去法によって解に辿り着くまでの各ステップを print で表示します。

### Google Colabでの一般的なガウスの消去法の実装例（途中経過を print で表示）

```python
import numpy as np

def gauss_elimination_verbose(A_aug):
    """
    ガウスの消去法を実装し、途中の過程を print で表示する関数。
    
    入力:
      A_aug: 拡大係数行列 (形状: (n, n+1))
    出力:
      x: 連立一次方程式の解を含むベクトル (形状: (n,))
    """
    n = A_aug.shape[0]
    
    print("初期の拡大係数行列:")
    print(A_aug)
    
    # 前進消去
    for i in range(n):
        # 部分ピボット選択：i列目の絶対値が最大の行を選ぶ
        max_row = i + np.argmax(np.abs(A_aug[i:, i]))
        print(f"\n列 {i} のピボット選択: 行 {max_row} を選択")
        
        # 行の入れ替え
        A_aug[[i, max_row]] = A_aug[[max_row, i]]
        print(f"行 {i} と 行 {max_row} を入れ替えた後:")
        print(A_aug)
        
        # ピボットの値
        pivot = A_aug[i, i]
        if np.isclose(pivot, 0):
            raise ValueError("行列は特異またはほぼ特異です。")
        
        # 行の定数倍：ピボット行を pivot で割り、ピボットを 1 にする
        A_aug[i] = A_aug[i] / pivot
        print(f"行 {i} を {pivot:.3f} で割って正規化した後:")
        print(A_aug)
        
        # 下の行から、現在の列の要素を 0 にする
        for j in range(i + 1, n):
            factor = A_aug[j, i]
            A_aug[j] = A_aug[j] - factor * A_aug[i]
            print(f"行 {j} から {factor:.3f}×行 {i} を引いた後:")
            print(A_aug)
    
    # 後退代入
    x = np.zeros(n)
    print("\n--- 後退代入開始 ---")
    for i in range(n - 1, -1, -1):
        x[i] = A_aug[i, -1] - np.dot(A_aug[i, i+1:n], x[i+1:n])
        print(f"x[{i}] = {x[i]:.3f} を計算")
    
    return x

# 連立一次方程式の例：
# (1) 3x + y + z = -5
# (2) 4x + 3y - z = -2
# (3) 5x + 4y + z = 6

A_aug = np.array([
    [3, 1, 1, -5],
    [4, 3, -1, -2],
    [5, 4, 1, 6]
], dtype=float)

solution = gauss_elimination_verbose(A_aug.copy())
print("\n連立一次方程式の解:")
print(f"x = {solution[0]:.3f}, y = {solution[1]:.3f}, z = {solution[2]:.3f}")
# 期待される解: x = -5, y = 7, z = 3
```

---

## 5. 学んだ内容がどのように応用されるか
- **工学・物理学:**  
  複数の条件を同時に満たす問題（例：構造解析、回路解析）で、連立一次方程式の解法は不可欠です。
- **経済学・最適化:**  
  市場均衡や資源配分の問題において、連立一次方程式の解法が基礎となります。
- **コンピュータグラフィックス:**  
  画像変換やレンダリングで、変換行列を用いた計算や平面の交点の求解などに応用されます。
- **機械学習:**  
  線形回帰や分類問題、データ前処理などの基礎として、数値解法が活用されます。

---

## 6. 演習問題
1. **演習問題1:**  
   次の連立一次方程式
   $$
   \begin{cases}
   3x + y + z = -5, \\\
   4x + 3y - z = -2, \\\
   5x + 4y + z = 6,
   \end{cases}
   $$
   の拡大係数行列を作成し、ガウスの消去法による基本変形（行の入れ替え、定数倍、行の加減）の各ステップを詳細に記述して、最終的な上三角行列と後退代入による解 $x=-5,\; y=7,\; z=3$ を求めよ。

2. **演習問題2:**  
   拡大係数行列の各変形ステップで、どの基本変形（行の入れ替え、定数倍、行の加減）を用いたかを明確にし、その理由を説明せよ。

3. **演習問題3:**  
   2変数の連立一次方程式（例: $2x + 3y = 8$ と $x - y = 1$）に対して、ガウスの消去法を用いて上三角行列に変形し、その解をグラフで直線の交点として可視化せよ。

4. **演習問題4:**  
   Google Colab 上で、実際にガウスの消去法の操作フロー（拡大係数行列の変形）を自分で実装し、その変化過程をコメント付きで記録せよ。