# 線形代数学 第24回：4次以上の行列式の計算

## 講義情報と予習ガイド

**講義回**: 第24回  
**分野**: 第3部 行列式  
**関連項目**: 行列式の計算法、基本変形、還元定理、余因子展開  
**予習すべき内容**: 第21-23回の内容（行列式の定義と基本性質、基本変形と行列式、還元定理と余因子展開）

## 学習目標

1. 4次以上の行列式を効率的に計算するための方法を理解する
2. 基本変形、還元定理、余因子展開を組み合わせた行列式計算の戦略を習得する
3. 特殊な形の行列（三角行列、対称行列など）の行列式計算を理解する
4. 行列式の計算過程で発生しうる数値的な問題とその対策を理解する

## 1. 基本概念の復習

### 1.1 行列式とは

> **定義**: $n \times n$行列 $A = [a_{ij}]$ の行列式は以下で定義される
> 
> $$\det(A) = |A| = \sum_{\sigma \in S_n} \text{sgn}(\sigma) \prod_{i=1}^n a_{i,\sigma(i)}$$
> 
> ここで $S_n$ は $n$ 次の置換全体の集合、$\text{sgn}(\sigma)$ は置換 $\sigma$ の符号

高次の行列式を直接この定義から計算するのは非常に労力がかかります。例えば、4次の行列式には24項、5次では120項の和が含まれます。そのため、計算を簡略化する様々な方法が開発されています。

### 1.2 行列式の基本性質（復習）

1. 行列の行または列を交換すると、行列式の符号が反転する
2. 行列のある行（列）に他の行（列）の定数倍を加えても、行列式の値は変わらない
3. 行列のある行（列）を定数倍すると、行列式はその定数倍になる
4. 行または列にゼロが含まれると、行列式の値は0になる
5. 三角行列の行列式は対角成分の積である
6. 行列 $A$ と $B$ の積の行列式は、それぞれの行列式の積に等しい：$\det(AB) = \det(A) \cdot \det(B)$

## 2. 4次以上の行列式計算の手法

### 2.1 基本変形による方法

高次の行列式を計算する最も基本的なアプローチは、基本行変形を用いて行列を三角行列または対角行列に変換することです。

**手順**:
1. 基本行変形を用いて、できるだけ多くの0を作る
2. 理想的には上三角または下三角行列に変換する
3. 対角成分の積を計算する

**例題1**: 次の4次行列の行列式を計算せよ。

$$A = \begin{pmatrix} 
1 & 2 & 3 & 4 \\
2 & 3 & 4 & 5 \\
3 & 4 & 5 & 6 \\
4 & 5 & 6 & 7
\end{pmatrix}$$

**解法**:
1. 第1行を基準として、他の行から適切な倍数を引く操作を行う
   - $R_2 \leftarrow R_2 - 2R_1$（第2行から第1行の2倍を引く）
   - $R_3 \leftarrow R_3 - 3R_1$（第3行から第1行の3倍を引く）
   - $R_4 \leftarrow R_4 - 4R_1$（第4行から第1行の4倍を引く）

$$\begin{pmatrix} 
1 & 2 & 3 & 4 \\
0 & -1 & -2 & -3 \\
0 & -2 & -4 & -6 \\
0 & -3 & -6 & -9
\end{pmatrix}$$

2. 第2行を基準として、第3行と第4行から適切な倍数を引く
   - $R_3 \leftarrow R_3 - 2R_2$（第3行から第2行の2倍を引く）
   - $R_4 \leftarrow R_4 - 3R_2$（第4行から第2行の3倍を引く）

$$\begin{pmatrix} 
1 & 2 & 3 & 4 \\
0 & -1 & -2 & -3 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0
\end{pmatrix}$$

3. 行列の第3行と第4行がゼロ行になったため、行列式は0となる

$$\det(A) = 0$$

### 2.2 還元定理を活用した方法

高次の行列式を計算する際に、還元定理は非常に強力なツールです。2次または3次の小行列式に還元することで、計算が大幅に簡略化されます。

> **還元定理**: 行列の第i行（または列）の各成分に、その余因子を掛けて和を取ると、行列式の値が得られる
> 
> $$\det(A) = \sum_{j=1}^{n} a_{ij} \cdot A_{ij}$$
> 
> ここで $A_{ij}$ は成分 $a_{ij}$ の余因子

**例題2**: 次の4次行列の行列式を還元定理を用いて計算せよ。

$$B = \begin{pmatrix} 
3 & 1 & 0 & 0 \\
1 & 3 & 1 & 0 \\
0 & 1 & 3 & 1 \\
0 & 0 & 1 & 3
\end{pmatrix}$$

**解法**:
1. 第1列を用いて余因子展開を行う

$$\det(B) = 3 \cdot M_{11} - 1 \cdot M_{21}$$

ここで、$M_{11}$は余因子行列、すなわち$B$の第1行第1列を除いた小行列式、$M_{21}$は$B$の第2行第1列を除いた小行列式である。

$$M_{11} = \begin{vmatrix} 
3 & 1 & 0 \\
1 & 3 & 1 \\
0 & 1 & 3
\end{vmatrix}$$

$$M_{21} = \begin{vmatrix} 
1 & 0 & 0 \\
1 & 3 & 1 \\
0 & 1 & 3
\end{vmatrix}$$

2. これらの3次行列式を計算する

$M_{11}$の計算:
- 第1列で余因子展開: $3 \cdot \begin{vmatrix} 3 & 1 \\ 1 & 3 \end{vmatrix} - 1 \cdot \begin{vmatrix} 1 & 0 \\ 1 & 3 \end{vmatrix}$
- $= 3 \cdot (3 \cdot 3 - 1 \cdot 1) - 1 \cdot (1 \cdot 3 - 0 \cdot 1)$
- $= 3 \cdot 8 - 1 \cdot 3 = 24 - 3 = 21$

$M_{21}$の計算:
- 第1列で余因子展開: $1 \cdot \begin{vmatrix} 3 & 1 \\ 1 & 3 \end{vmatrix} - 1 \cdot \begin{vmatrix} 0 & 0 \\ 1 & 3 \end{vmatrix}$
- $= 1 \cdot 8 - 1 \cdot 0 = 8$

3. 元の行列式を計算

$$\det(B) = 3 \cdot 21 - 1 \cdot 8 = 63 - 8 = 55$$

### 2.3 効率的な展開を選択する戦略

高次の行列式を計算する際には、計算を最も簡略化できる行または列を選んで展開することが重要です。

**展開の選択基準**:
1. ゼロ成分が最も多い行または列を選ぶ
2. パターンが認識できる場合（三角行列、対角行列など）は、それを活用する
3. 小行列式に既知のパターンが現れるよう展開方法を選ぶ

**例題3**: 次の5次行列の行列式を計算せよ。

$$C = \begin{pmatrix} 
1 & 0 & 2 & 0 & 3 \\
0 & 4 & 0 & 5 & 0 \\
0 & 0 & 6 & 0 & 0 \\
0 & 7 & 0 & 8 & 0 \\
9 & 0 & 0 & 0 & 10
\end{pmatrix}$$

**解法**:
ゼロが最も多い第3行で展開する

$$\det(C) = 6 \cdot \begin{vmatrix} 
1 & 0 & 0 & 3 \\
0 & 4 & 5 & 0 \\
0 & 7 & 8 & 0 \\
9 & 0 & 0 & 10
\end{vmatrix}$$

この4次行列も多くのゼロを含んでいるため、第4列で展開するのが効率的

$$6 \cdot \left( 3 \cdot \begin{vmatrix} 
0 & 4 & 5 \\
0 & 7 & 8 \\
9 & 0 & 0
\end{vmatrix} - 0 \cdot (\cdots) + 0 \cdot (\cdots) - 10 \cdot \begin{vmatrix} 
1 & 0 & 0 \\
0 & 4 & 5 \\
0 & 7 & 8
\end{vmatrix} \right)$$

$$= 6 \cdot \left( 3 \cdot 9 \cdot \begin{vmatrix} 
4 & 5 \\
7 & 8
\end{vmatrix} - 10 \cdot \begin{vmatrix} 
4 & 5 \\
7 & 8
\end{vmatrix} \right)$$

$$= 6 \cdot (3 \cdot 9 - 10) \cdot (4 \cdot 8 - 5 \cdot 7)$$
$$= 6 \cdot (27 - 10) \cdot (32 - 35)$$
$$= 6 \cdot 17 \cdot (-3) = -306$$

## 3. 特殊な形状の行列の行列式

特殊な形状の行列に対しては、計算が大幅に簡略化される場合があります。

### 3.1 三角行列

> **定理**: 三角行列（上三角または下三角）の行列式は、対角成分の積に等しい
> 
> $$\det(T) = t_{11} \cdot t_{22} \cdot \ldots \cdot t_{nn}$$

**例題4**: 次の上三角行列の行列式を計算せよ。

$$D = \begin{pmatrix} 
2 & 3 & 4 & 5 \\
0 & 3 & 1 & 2 \\
0 & 0 & 4 & 6 \\
0 & 0 & 0 & 1
\end{pmatrix}$$

**解法**:
対角成分の積を計算する
$$\det(D) = 2 \cdot 3 \cdot 4 \cdot 1 = 24$$

### 3.2 ブロック対角行列

> **定理**: ブロック対角行列の行列式は、各ブロックの行列式の積に等しい
> 
> $$\det\begin{pmatrix} A & 0 \\ 0 & B \end{pmatrix} = \det(A) \cdot \det(B)$$

**例題5**: 次のブロック対角行列の行列式を計算せよ。

$$E = \begin{pmatrix} 
2 & 1 & 0 & 0 \\
3 & 4 & 0 & 0 \\
0 & 0 & 5 & 2 \\
0 & 0 & 1 & 3
\end{pmatrix}$$

**解法**:
2つのブロックの行列式を個別に計算し、それらの積を求める

$$\det(E) = \begin{vmatrix} 2 & 1 \\ 3 & 4 \end{vmatrix} \cdot \begin{vmatrix} 5 & 2 \\ 1 & 3 \end{vmatrix}$$
$$= (2 \cdot 4 - 1 \cdot 3) \cdot (5 \cdot 3 - 2 \cdot 1)$$
$$= 5 \cdot 13 = 65$$

### 3.3 特殊なパターンを持つ行列

**例題6**: 以下の特殊な形状の5次行列の行列式を計算せよ。

$$F = \begin{pmatrix} 
a & b & b & b & b \\
b & a & b & b & b \\
b & b & a & b & b \\
b & b & b & a & b \\
b & b & b & b & a
\end{pmatrix}$$

**解法**:
この行列はすべての対角成分が $a$ で、他の成分がすべて $b$ である特殊な形をしています。このような行列の行列式は以下の公式で計算できます：

$$\det(F) = (a-b)^{n-1} \cdot (a+(n-1)b)$$

ここで $n = 5$ なので：

$$\det(F) = (a-b)^4 \cdot (a+4b)$$

これはパターンを認識して特殊な公式を適用した例です。

## 4. 数値計算上の課題とその対策

### 4.1 数値的安定性の問題

高次行列の行列式を計算する際には、以下のような数値計算上の問題が発生することがあります：

1. **桁落ち**：似た大きさの数の引き算で精度が失われる
2. **丸め誤差の蓄積**：多くの演算を行うことで誤差が累積する
3. **オーバーフロー/アンダーフロー**：非常に大きな/小さな数値が発生する

### 4.2 対策方法

1. **ピボット選択**：計算途中で最も適切な行・列を選んで展開する
2. **数値的に安定なアルゴリズム**：ガウスの消去法やLU分解などを使用する
3. **行列式を直接計算しない**：行列式が必要な場合でも、他の方法（例：LU分解）を用いる

### 4.3 行列式の計算におけるLU分解の利用

> **定理**: $A = LU$ と分解できる場合（$L$は対角成分が1の下三角行列、$U$は上三角行列）、
> 
> $$\det(A) = \det(L) \cdot \det(U) = \prod_{i=1}^n u_{ii}$$

**例題7**: 次の行列の行列式をLU分解を用いて計算せよ。

$$G = \begin{pmatrix} 
4 & 3 & 2 & 1 \\
3 & 4 & 3 & 2 \\
2 & 3 & 4 & 3 \\
1 & 2 & 3 & 4
\end{pmatrix}$$

**解法**:
LU分解を用いて行列を分解し、$U$の対角成分の積を計算します。（計算過程は省略し、結果のみ示します）

$$L = \begin{pmatrix} 
1 & 0 & 0 & 0 \\
0.75 & 1 & 0 & 0 \\
0.5 & 0.8 & 1 & 0 \\
0.25 & 0.6 & 0.833 & 1
\end{pmatrix}, 
U = \begin{pmatrix} 
4 & 3 & 2 & 1 \\
0 & 1.75 & 1.5 & 1.25 \\
0 & 0 & 0.7 & 1.0 \\
0 & 0 & 0 & 0.2
\end{pmatrix}$$

$$\det(G) = 4 \cdot 1.75 \cdot 0.7 \cdot 0.2 = 0.98$$

## 5. Pythonによる実装と可視化

行列式の計算は、NumPy ライブラリを用いて簡単に行うことができます。

```python
import numpy as np
import matplotlib.pyplot as plt
from numpy.linalg import det, qr
import time

# 行列の定義
A = np.array([[1, 2, 3, 4],
              [2, 3, 4, 5],
              [3, 4, 5, 6],
              [4, 5, 6, 7]])

B = np.array([[3, 1, 0, 0],
              [1, 3, 1, 0],
              [0, 1, 3, 1],
              [0, 0, 1, 3]])

# 行列式の計算
det_A = det(A)
det_B = det(B)

print(f"det(A) = {det_A}")
print(f"det(B) = {det_B}")

# 性能比較：行列のサイズによる計算時間の違い
sizes = range(2, 11)
times_det = []

for n in sizes:
    # ランダムな行列を作成
    M = np.random.rand(n, n)
    
    # 計算時間を測定
    start = time.time()
    d = det(M)
    end = time.time()
    
    times_det.append(end - start)

# 計算時間のプロット
plt.figure(figsize=(10, 6))
plt.plot(sizes, times_det, 'o-', label='NumPy det()')
plt.xlabel('行列サイズ')
plt.ylabel('計算時間 (秒)')
plt.title('行列式計算の計算時間 vs. 行列サイズ')
plt.grid(True)
plt.legend()
plt.show()

# LU分解を用いた行列式の計算
def det_using_lu(M):
    # QR分解を使用（安定性のため）
    Q, R = qr(M)
    # 上三角行列Rの対角要素の積
    return np.prod(np.diag(R)) * np.linalg.det(Q)

# 例
G = np.array([[4, 3, 2, 1],
              [3, 4, 3, 2],
              [2, 3, 4, 3],
              [1, 2, 3, 4]])

det_G_direct = det(G)
det_G_lu = det_using_lu(G)

print(f"det(G) (直接計算) = {det_G_direct}")
print(f"det(G) (LU分解) = {det_G_lu}")
```

このコードは行列式の計算を実演し、行列サイズに応じた計算時間の変化をプロットしています。また、LU分解を用いた計算方法も実装しています。

## 6. 演習問題

### 基本問題

1. 次の4次行列の行列式を計算しなさい。
   $$\begin{pmatrix} 
   1 & 2 & 0 & 0 \\
   3 & 4 & 0 & 0 \\
   0 & 0 & 5 & 6 \\
   0 & 0 & 7 & 8
   \end{pmatrix}$$

2. 次の4次行列の行列式を計算しなさい。
   $$\begin{pmatrix} 
   1 & 1 & 1 & 1 \\
   0 & 2 & 2 & 2 \\
   0 & 0 & 3 & 3 \\
   0 & 0 & 0 & 4
   \end{pmatrix}$$

3. 次の5次行列の行列式を計算しなさい。
   $$\begin{pmatrix} 
   2 & 0 & 0 & 0 & 0 \\
   1 & 3 & 0 & 0 & 0 \\
   1 & 1 & 4 & 0 & 0 \\
   1 & 1 & 1 & 5 & 0 \\
   1 & 1 & 1 & 1 & 6
   \end{pmatrix}$$

4. 次の行列の行列式を計算しなさい。
   $$\begin{pmatrix} 
   a & 0 & 0 & 0 \\
   b & c & 0 & 0 \\
   0 & d & e & 0 \\
   0 & 0 & f & g
   \end{pmatrix}$$

### 応用問題

5. 次の4次行列の行列式を計算しなさい。
   $$\begin{pmatrix} 
   1 & 2 & 3 & 4 \\
   5 & 6 & 7 & 8 \\
   9 & 10 & 11 & 12 \\
   13 & 14 & 15 & 16
   \end{pmatrix}$$

6. 以下の医療データの分析に関する行列の行列式を計算し、この行列の可逆性について考察しなさい。行列$X$は患者の特徴量（年齢、体重、身長、血圧）を表しており、これを用いて線形回帰モデルを構築しようとしている。
   $$X^TX = \begin{pmatrix} 
   100 & 350 & 520 & 420 \\
   350 & 1300 & 1850 & 1500 \\
   520 & 1850 & 2700 & 2150 \\
   420 & 1500 & 2150 & 1800
   \end{pmatrix}$$

7. 次の形の$n$次正方行列の行列式の一般公式を求めなさい。
   $$\begin{pmatrix} 
   x & a & a & \cdots & a \\
   a & x & a & \cdots & a \\
   a & a & x & \cdots & a \\
   \vdots & \vdots & \vdots & \ddots & \vdots \\
   a & a & a & \cdots & x
   \end{pmatrix}$$

## 7. よくある質問と解答

**Q1: 高次行列の行列式を計算する際、最も効率的な方法は何ですか？**

A1: 一般的には、以下の方法が効率的です：
1. 行列にゼロ成分が多い場合は、それらを含む行または列で余因子展開を行う
2. 基本変形を用いて三角行列に変換する
3. 特殊なパターンがある場合は、それに対応した公式を使用する
4. 数値計算では、安定性を考慮してLU分解などの手法を用いる

**Q2: 行列が特異（singular）であるとはどういう意味ですか？**

A2: 行列が特異であるとは、その行列式が0になることを意味します。特異行列は逆行列を持たず、対応する連立方程式システムは一意の解を持ちません。このような行列は、線形従属な行（または列）を持っています。

**Q3: 行列式の計算において、基本変形を行うとき注意すべき点は何ですか？**

A3: 基本変形では以下の点に注意する必要があります：
1. 行または列の交換を行うと、行列式の符号が反転する
2. 行または列に定数をかけると、行列式はその定数倍になる
3. ある行（列）に他の行（列）の定数倍を加える操作は、行列式の値を変えない

**Q4: 行列式の計算がデータ分析でどのように役立ちますか？**

A4: 行列式は以下のような場面で役立ちます：
1. 線形変換の体積変化率を表す（幾何学的解釈）
2. 行列の可逆性の判定（行列式が0でなければ可逆）
3. 線形方程式系の解の存在と一意性の判定
4. 多変量統計解析における分散共分散行列の特性評価
5. 主成分分析や因子分析の前処理として行列の特性を調べる際の指標

**Q5: 大きな行列の行列式を計算する際、数値的な問題が発生することがありますか？**

A5: はい、特に以下のような問題が発生することがあります：
1. 丸め誤差の累積
2. 桁落ち（似た値の引き算による精度の損失）
3. オーバーフロー/アンダーフロー
4. 条件数の悪い行列での不安定性

これらの問題を回避するには、直接的な計算よりも、QR分解やLU分解などの数値的に安定なアルゴリズムを使用することが推奨されます。