
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Statistics, Tomoshige Nakamura, Machine Learning, Juntendo University">
      
      
        <meta name="author" content="Tomoshige Nakamura">
      
      
        <link rel="canonical" href="https://tomoshige.github.io/website/lectures/SIWS/03-wrangling/">
      
      
        <link rel="prev" href="../02-visualization/">
      
      
        <link rel="next" href="../04-data-import-and-tidy-data/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>3. Data Wrangling - Statistical Learning Laboratory</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../../.." title="Statistical Learning Laboratory" class="md-header__button md-logo" aria-label="Statistical Learning Laboratory" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Statistical Learning Laboratory
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Data Wrangling
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://tomoshige.github.io/website" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    tomoshige/website
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Lectures

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../research/" class="md-tabs__link">
          
  
    
  
  Research

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Statistical Learning Laboratory" class="md-nav__button md-logo" aria-label="Statistical Learning Laboratory" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Statistical Learning Laboratory
  </label>
  
    <div class="md-nav__source">
      <a href="https://tomoshige.github.io/website" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    tomoshige/website
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Lectures
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Lectures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../LA/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Linear algebra
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Linear algebra
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/01-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/02-vector-and-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Vector and Matrix1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/03-vector-and-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Vector and Matrix2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/04-vector-and-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Vector and Matrix3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/05-vector-and-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Vector and Matrix4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/06-vector-and-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Vector and Matrix5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/07-vector-and-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Vector and Matrix6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/08-vector-and-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Vector and Matrix7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/09-exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Exersice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/10-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/11-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/12-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/13-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/14-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/15-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/16-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/17-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/18-system-of-linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18. System of Linear Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/19-exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19. Exercise
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/20-midterm-exam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20. Midterm Exam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/21-determinant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21. Determinant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/22-determinant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    22. Determinant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/23-determinant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23. Determinant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/24-determinant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    24. Determinant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/25-exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    25. Exercise
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/26-vector-space-and-inner-product/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    26. Vector space
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/27-vector-space-and-inner-product/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    27. Vector space
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/28-vector-space-and-inner-product/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    28. Vector space
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/29-exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    29. Exercise
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/30-report/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    30. Report Exam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/31-exam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    31. Semester Exam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/32-eigen-value-vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    32. Eigen value and vector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/33-eigen-value-vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    33. Eigen value and vector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/34-eigen-value-vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    34. Eigen value and vector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/35-eigen-value-vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    35. Eigen value and vector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/36-eigen-value-vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    36. Eigen value and vector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/37-exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    37. Exercise
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/38-midterm-exam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    38. Midterm Exam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/39-singular-value-decomposition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    39. Singular value decomposition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/40-singular-value-decomposition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    40. Singular value decomposition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/41-principal-component-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    41. Principal component analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/42-principal-component-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    42. Principal component analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/43-principal-component-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    43. Principal component analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/44-factor-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    44. Factor analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/45-factor-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    45. Factor analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/46-nonlinear-dimension-reduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    46. Nonlinear dimension reduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/47-wrapup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    47. Wrap up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LA/48-final-report/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    48. Final Report
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Data Science without syntax
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Data Science without syntax
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Getting-Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Data Visualizaion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    3. Data Wrangling
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    3. Data Wrangling
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      必要なライブラリ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      メソッドチェーン
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      行のフィルタリング
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      変数の要約
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      行のグループ化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="行のグループ化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      複数の変数でのグループ化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      既存の変数の変更
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      行の並べ替え
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      データフレームの結合
    </span>
  </a>
  
    <nav class="md-nav" aria-label="データフレームの結合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      一致する「キー」変数名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      異なる「キー」変数名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      複数の「キー」変数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      正規形
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      その他の操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="その他の操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      変数の選択
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      変数の名前変更
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n" class="md-nav__link">
    <span class="md-ellipsis">
      変数の上位n個の値
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      結論
    </span>
  </a>
  
    <nav class="md-nav" aria-label="結論">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      要約表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      その他のリソース
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      次に何が来るか？
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-data-import-and-tidy-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Data Import and Tidy Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-simple-linear-regression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Simple Linear Regression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-multiple-regression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Multiple Regression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-sampling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Sampling Method
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-Estimation-CI-Bootstrapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Estimation, Confidence Interval and Bootstrapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-hypothesis-testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Hypothesis Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-inference-for-regression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. Inference for Regression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-tell-your-story-with-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11. Tell Your Story with Data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../SP/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Statistics and Probability
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Statistics and Probability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../research/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Research
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Research
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/generalized-random-forests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generalized random forests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/variable-importance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variable Importance Measures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/forest-kernel-and-its-asymptotics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Random forest kernels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/consistency-of-soft-decision-trees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Consistency of SRT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/sparseBART/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sparse Causal BART
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/causal-mediation-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Causal mediation analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/causal-data-repository/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Causal data repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/causal-brain-analysis.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Causal Brain Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../research/note/factor-analysis/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Factor analysis
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            Factor analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/01-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/02-factor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. 因子とは
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/03-factor-loading-matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. 因子負荷行列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/04-latent-factor-estimation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. 潜在因子推定法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/05-rotation-and-interpretation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. 回転基準と結果の解釈
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/06-sensitivity-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. 感度分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/07-analysis-step/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. 因子分析の手順
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/08-simulation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. シミュレーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/09-pima-indians-diabetes-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. 糖尿病潜在原因分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/10-ordered-categorical-factor-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. 順序ありカテゴリカル変数の扱い
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/11-airline-passenger-satisfaction-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11. 飛行機乗客満足度分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/note/factor-analysis/12-technical-note-matrix-factorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12. 行列分解と因子分析(Technical)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      必要なライブラリ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      メソッドチェーン
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      行のフィルタリング
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      変数の要約
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      行のグループ化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="行のグループ化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      複数の変数でのグループ化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      既存の変数の変更
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      行の並べ替え
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      データフレームの結合
    </span>
  </a>
  
    <nav class="md-nav" aria-label="データフレームの結合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      一致する「キー」変数名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      異なる「キー」変数名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      複数の「キー」変数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      正規形
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      その他の操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="その他の操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      変数の選択
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      変数の名前変更
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n" class="md-nav__link">
    <span class="md-ellipsis">
      変数の上位n個の値
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      結論
    </span>
  </a>
  
    <nav class="md-nav" aria-label="結論">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      要約表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      その他のリソース
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      次に何が来るか？
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="_1">データラングリング</h1>
<p>これまでの旅では、第1章で<code>glimpse()</code>や<code>View()</code>関数を使ってデータフレームを調べる方法と、第2章で<code>ggplot2</code>パッケージを使ったデータ可視化の方法について学びました。特に「5つの基本グラフ」を勉強しました：</p>
<ol>
<li>散布図（<code>geom_point()</code>）</li>
<li>折れ線グラフ（<code>geom_line()</code>）</li>
<li>箱ひげ図（<code>geom_boxplot()</code>）</li>
<li>ヒストグラム（<code>geom_histogram()</code>）</li>
<li>棒グラフ（<code>geom_bar()</code>または<code>geom_col()</code>）</li>
</ol>
<p>これらの可視化はグラフィックス文法を使って作成しました。データフレーム内の変数を5つの幾何学的オブジェクトのいずれかの審美的属性にマッピングします。Gapminderデータの例（第2章の図）のように、サイズや色などの幾何学的オブジェクトの他の審美的属性も制御できます。</p>
<p>本章では、pandasライブラリのデータラングリング関数を紹介します。これらの関数を使えば、データフレームを変換して目的に合わせることができます。主な関数は：</p>
<ol>
<li>条件に合う行を選択する</li>
<li>列を要約統計量で集計する</li>
<li>行をグループ化する。グループ化と集計を組み合わせると、グループごとに別々の要約統計量を計算できる</li>
<li>既存の列から新しい列を作成する</li>
<li>行を並べ替える</li>
<li>「キー」変数に基づいて別のデータフレームと結合する</li>
</ol>
<p>この章では、これらの操作をPythonのpandasライブラリで行う方法を学びます。</p>
<p>pandasを学ぶもう一つの利点は、データベース照会言語の<a href="https://en.wikipedia.org/wiki/SQL">SQL</a>との類似性です。SQLは大規模なデータベースを迅速かつ効率的に管理するために使用され、多くのデータを持つ組織で広く使われています。pandasを学ぶとSQLも簡単に習得できるでしょう。</p>
<h3 id="_2">必要なライブラリ</h3>
<p>まずは、この章に必要なライブラリをインポートしましょう。</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.express</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">px</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plotly.subplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>

<span class="c1"># プロットの設定</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-v0_8-whitegrid&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
</code></pre></div>
<p>また、この章で使用するnycflights13データセットをダウンロードします。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># NYCフライトデータの読み込み</span>
<span class="n">flights_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/flights.csv&quot;</span>
<span class="n">flights</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">flights_url</span><span class="p">)</span>

<span class="c1"># airlinesデータの読み込み</span>
<span class="n">airlines_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/airlines.csv&quot;</span>
<span class="n">airlines</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">airlines_url</span><span class="p">)</span>

<span class="c1"># airportsデータの読み込み</span>
<span class="n">airports_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/airports.csv&quot;</span>
<span class="n">airports</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">airports_url</span><span class="p">)</span>

<span class="c1"># weatherデータの読み込み</span>
<span class="n">weather_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/weather.csv&quot;</span>
<span class="n">weather</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">weather_url</span><span class="p">)</span>

<span class="c1"># planesデータの読み込み</span>
<span class="n">planes_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/ismayc/pnwflights14/master/data/planes.csv&quot;</span>
<span class="n">planes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">planes_url</span><span class="p">)</span>

<span class="c1"># データの確認</span>
<span class="n">flights</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<h2 id="_3">メソッドチェーン</h2>
<p>Rの<code>dplyr</code>パッケージで使われるパイプ演算子（<code>%&gt;%</code>）に相当するのが、Pythonのpandasにおけるメソッドチェーンです。メソッドチェーンを使うと、複数の操作を連続した1つのシーケンスとして組み合わせることができます。</p>
<p>仮想的な例を考えてみましょう。データフレーム<code>x</code>に対して、関数<code>f()</code>、<code>g()</code>、そして<code>h()</code>という3つの操作を順番に実行したいとします：</p>
<ol>
<li><code>x</code>を取り、次に</li>
<li><code>x</code>を入力として関数<code>f()</code>を適用し、次に</li>
<li><code>f(x)</code>の出力を入力として関数<code>g()</code>を適用し、次に</li>
<li><code>g(f(x))</code>の出力を入力として関数<code>h()</code>を適用する</li>
</ol>
<p>Rでこれを実現する1つの方法はネストされた括弧を使うことです：<code>h(g(f(x)))</code></p>
<p>pandasでは、メソッドチェーンを使って同じことができます：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 仮想的な例</span>
<span class="c1"># x.f().g().h()</span>
</code></pre></div>
<p>これは以下のように読むことができます：</p>
<ol>
<li><code>x</code>を取り、次に</li>
<li>この出力を入力として次の関数<code>f()</code>に渡し、次に</li>
<li>この出力を入力として次の関数<code>g()</code>に渡し、次に</li>
<li>この出力を入力として次の関数<code>h()</code>に渡す</li>
</ol>
<p>この章のデータラングリングを通じて：</p>
<ol>
<li>初期値<code>x</code>はデータフレームです。例えば、第1章で探索した<code>flights</code>データフレームです。</li>
<li>関数のシーケンス（ここでは<code>f()</code>、<code>g()</code>、<code>h()</code>）は、主に本章の冒頭で紹介した6つのデータラングリング操作のいずれかです。</li>
<li>結果は変換/修正されたデータフレームになります。</li>
</ol>
<p>例えば、Alaskaの航空会社のフライトだけを抽出するには：</p>
<div class="highlight"><pre><span></span><code><span class="n">alaska_flights</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AS&#39;</span><span class="p">]</span>
</code></pre></div>
<p>メソッドチェーンを使うと、複数の操作を一連の操作として結合できます。これにより、コードの可読性が向上します。</p>
<h2 id="_4">行のフィルタリング</h2>
<p><img alt="フィルタリング操作の図" src="https://d33wubrfki0l68.cloudfront.net/8787a2a48275a9e5a8d21fbc8e77c0f391bdfdac/fef13/images/cheatsheets/filter.png" /></p>
<p>pandasのフィルタリング機能は、Microsoft Excelの「フィルター」オプションに似ています。データセット内の変数の値に関する条件を指定し、その条件に一致する行だけをフィルタリングできます。</p>
<p>まず、ニューヨーク市からポートランド、オレゴン州（空港コード「PDX」）への便だけに焦点を当ててみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="n">portland_flights</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PDX&#39;</span><span class="p">]</span>
<span class="n">portland_flights</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>コードの順序に注目してください。<code>flights</code>データフレームを取り、その後<code>dest</code>が「PDX」と等しい行だけをフィルタリングしています。等値テストには<code>==</code>演算子を使います。</p>
<p>他の演算子も使用できます：</p>
<ul>
<li><code>&gt;</code> は「より大きい」</li>
<li><code>&lt;</code> は「より小さい」</li>
<li><code>&gt;=</code> は「以上」</li>
<li><code>&lt;=</code> は「以下」</li>
<li><code>!=</code> は「等しくない」</li>
</ul>
<p>さらに、比較演算子を使用して複数の条件を組み合わせることができます：</p>
<ul>
<li><code>|</code> は「または」</li>
<li><code>&amp;</code> は「かつ」</li>
</ul>
<p>これらの多くを試してみましょう。JFKから出発し、バーリントン（「BTV」）またはシアトル（「SEA」）に向かう、10月、11月、12月に出発した便をフィルタリングします：</p>
<div class="highlight"><pre><span></span><code><span class="n">btv_sea_flights_fall</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span>
    <span class="p">(</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;JFK&#39;</span><span class="p">)</span> <span class="o">&amp;</span> 
    <span class="p">((</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;BTV&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SEA&#39;</span><span class="p">))</span> <span class="o">&amp;</span> 
    <span class="p">(</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">btv_sea_flights_fall</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>括弧の慎重な使用に注目してください。</p>
<p>バーリントン、VTまたはシアトル、WAに向かわない便を選択するために「not」演算子（<code>~</code>）を使用することもできます：</p>
<div class="highlight"><pre><span></span><code><span class="n">not_BTV_SEA</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span><span class="o">~</span><span class="p">((</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;BTV&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SEA&#39;</span><span class="p">))]</span>
<span class="n">not_BTV_SEA</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>多数の空港をフィルタリングしたい場合（例：「SEA」、「SFO」、「PDX」、「BTV」、「BDL」）、<code>isin()</code>メソッドを使用すると便利です：</p>
<div class="highlight"><pre><span></span><code><span class="n">many_airports</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;SEA&#39;</span><span class="p">,</span> <span class="s1">&#39;SFO&#39;</span><span class="p">,</span> <span class="s1">&#39;PDX&#39;</span><span class="p">,</span> <span class="s1">&#39;BTV&#39;</span><span class="p">,</span> <span class="s1">&#39;BDL&#39;</span><span class="p">])]</span>
<span class="n">many_airports</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>このコードは、<code>dest</code>が空港リスト「SEA」、「SFO」、「PDX」、「BTV」、「BDL」にある便をフィルタリングします。<code>isin()</code>メソッドは、ある変数の値がリスト内の値と一致するかどうかを確認するのに便利です。</p>
<p>フィルタリングは、最初に適用すべきデータ操作の一つです。これにより、関心のある行だけを含むようにデータセットをクリーンアップできます。</p>
<p><strong>学習チェック：</strong></p>
<p>「not」演算子（<code>~</code>）を使用して、バーリントン、VTもシアトル、WAにも向かわない行だけをフィルタリングする別の方法は何ですか？前のコードを使用してこれをテストしてみましょう。</p>
<h2 id="_5">変数の要約</h2>
<p>次によく行われるデータフレームの操作は、要約統計量の計算です。要約統計量は、多くの値を要約する単一の数値です。よく知られている例としては、平均（算術平均とも呼ばれる）や中央値（中間値）などがあります。その他の要約統計量の例としては、合計、最小値、最大値、標準偏差などがあります。</p>
<p>weatherデータフレーム内の温度変数の2つの要約統計量（平均と標準偏差）を計算してみましょう：</p>
<p><img alt="要約関数の図" src="https://d33wubrfki0l68.cloudfront.net/c5ffd65be2c76de9a9836feee8656712c2696384/c5c95/images/cheatsheets/summary.png" /></p>
<p>これらの要約統計量を計算するには、pandasの<code>mean()</code>と<code>std()</code>メソッドを使用します：</p>
<div class="highlight"><pre><span></span><code><span class="n">summary_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()],</span>
    <span class="s1">&#39;std_dev&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()]</span>
<span class="p">})</span>
<span class="n">summary_temp</span>
</code></pre></div>
<p>欠損値（NA）がある場合、デフォルトでは要約統計量を計算すると<code>NaN</code>が返されます。これを回避するには、<code>dropna=True</code>引数を設定します：</p>
<div class="highlight"><pre><span></span><code><span class="n">summary_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
    <span class="s1">&#39;std_dev&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
<span class="p">})</span>
<span class="n">summary_temp</span>
</code></pre></div>
<p>ただし、欠損値を無視する際には注意が必要です。これは、欠損値の存在とその潜在的な原因に注意を払う必要があるためです。</p>
<p>他にもいくつかの要約関数があります：</p>
<ul>
<li><code>mean()</code>: 平均</li>
<li><code>std()</code>: 標準偏差（ばらつきの指標）</li>
<li><code>min()</code>と<code>max()</code>: 最小値と最大値</li>
<li><code>quantile([0.25, 0.75])</code>: 四分位範囲を求めるのに使用</li>
<li><code>sum()</code>: 複数の数値を加算した合計</li>
<li><code>count()</code>: 行数のカウント</li>
</ul>
<p><strong>学習チェック：</strong></p>
<p>医師が多数の患者を対象に喫煙と肺癌の関係を研究しています。患者の記録は5年ごとに測定されています。患者の死亡により多くの患者にデータポイントが欠けているため、分析ではこれらの患者を無視することにしました。この医師のアプローチの問題点は何ですか？</p>
<p>次の<code>summarize()</code>関数を修正して、<code>n()</code>要約関数も使用するようにしてください：<code>summarize(... , count = n())</code>。返された値は何に対応していますか？</p>
<h2 id="_6">行のグループ化</h2>
<p><img alt="グループ化と要約の図" src="https://d33wubrfki0l68.cloudfront.net/9007dfd0d2ebcfa055d78e4a28cb1aadf7eb4cc0/3c354/images/cheatsheets/group_summary.png" /></p>
<p>1年間の単一平均気温ではなく、12ヶ月それぞれに対して12の平均気温が欲しいとします。つまり、月別に分けて平均気温を計算したいです。これは、「月」変数の12の値によって観測を「グループ化」することで実現できます：</p>
<div class="highlight"><pre><span></span><code><span class="n">summary_monthly_temp</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># カラム名の整理</span>
<span class="n">summary_monthly_temp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std_dev&#39;</span><span class="p">]</span>
<span class="n">summary_monthly_temp</span>
</code></pre></div>
<p><code>groupby()</code>関数はデータフレームを変更しないことに注意することが重要です。代わりに、メタデータ（データに関するデータ）、特にグループ化構造を変更します。<code>agg()</code>関数を適用した後にのみデータフレームが変更されます。</p>
<p>例として、ggplot2パッケージに含まれる<code>diamonds</code>データフレームを考えてみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># diamondsデータセットの読み込み</span>
<span class="n">diamonds_url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/tidyverse/ggplot2/master/data-raw/diamonds.csv&quot;</span>
<span class="n">diamonds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">diamonds_url</span><span class="p">)</span>
<span class="n">diamonds</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p><code>cut</code>でグループ化してみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="n">diamonds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cut&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</code></pre></div>
<p>メタデータは変更されましたが、データ自体は変更されていません。<code>groupby()</code>と別のデータラングリング操作（この場合は<code>agg()</code>）を組み合わせると、データが実際に変換されます：</p>
<div class="highlight"><pre><span></span><code><span class="n">diamonds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cut&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div>
<p>次に、<code>n()</code>カウント要約関数を再訪してみましょう。3つのニューヨーク市空港からそれぞれ何機の便が出発したかをカウントするとします：</p>
<div class="highlight"><pre><span></span><code><span class="n">by_origin</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;origin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="n">by_origin</span>
</code></pre></div>
<p>ニューワーク（「EWR」）が2013年に最も多くの便が出発し、その後に「JFK」と最後にラガーディア（「LGA」）が続いています。</p>
<h3 id="_7">複数の変数でのグループ化</h3>
<p>一つの変数でのグループ化に限定されません。各月ごとに3つのニューヨーク市空港から出発する便の数を知りたいとします。第2の変数<code>month</code>でもグループ化できます：</p>
<div class="highlight"><pre><span></span><code><span class="n">by_origin_monthly</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="n">by_origin_monthly</span>
</code></pre></div>
<p><code>by_origin_monthly</code>には36行あります（3つの空港「EWR」、「JFK」、「LGA」に対して12ヶ月あるため）。</p>
<p><strong>学習チェック：</strong></p>
<p>第2章でニューヨーク市の月別気温を見たことを思い出してください。<code>summary_monthly_temp</code>データフレームの標準偏差の列は、一年を通じてのニューヨーク市の気温について何を教えてくれますか？</p>
<p>2013年のニューヨーク市の各日の平均気温と標準偏差を得るために必要なコードは何ですか？</p>
<p><code>by_monthly_origin</code>を再作成しますが、<code>groupby(['origin', 'month'])</code>ではなく、<code>groupby(['month', 'origin'])</code>のように変数を異なる順序でグループ化してください。結果のデータセットで何が異なりますか？</p>
<h2 id="_8">既存の変数の変更</h2>
<p><img alt="変数の変更の図" src="https://d33wubrfki0l68.cloudfront.net/3de15079ade7016a277d777a7720d3a490d10dc7/4bc00/images/cheatsheets/mutate.png" /></p>
<p>データの一般的な変換は、既存の変数に基づいて新しい変数を作成/計算することです。例えば、温度を華氏（°F）ではなく摂氏（°C）で考える方が慣れているとします。華氏から摂氏への変換式は：</p>
<div class="arithmatex">\[
\text{temp in C} = \frac{\text{temp in F} - 32}{1.8}
\]</div>
<p>pandasでは、新しい列を追加することでこの式を<code>temp</code>変数に適用できます：</p>
<div class="highlight"><pre><span></span><code><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;temp_in_C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">weather</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.8</span>

<span class="c1"># 華氏と摂氏の両方で月平均気温を計算する</span>
<span class="n">summary_monthly_temp</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;temp_in_C&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span>
<span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># カラム名の整理</span>
<span class="n">summary_monthly_temp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_temp_in_F&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_temp_in_C&#39;</span><span class="p">]</span>
<span class="n">summary_monthly_temp</span>
</code></pre></div>
<p>別の例を考えてみましょう。乗客はしばしば便が遅れて出発すると不満を感じますが、パイロットがフライト中に時間を取り戻せば、それほど苛立ちません。これは航空業界では「利得」と呼ばれ、この変数を作成します：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span><span class="s1">&#39;dep_delay&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">flights</span><span class="p">[</span><span class="s1">&#39;arr_delay&#39;</span><span class="p">]</span>

<span class="c1"># 最初の5行の出発/到着遅延と利得変数を見てみる</span>
<span class="n">flights</span><span class="p">[[</span><span class="s1">&#39;dep_delay&#39;</span><span class="p">,</span> <span class="s1">&#39;arr_delay&#39;</span><span class="p">,</span> <span class="s1">&#39;gain&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p><code>gain</code>変数のいくつかの要約統計量を見てみましょう：</p>
<div class="highlight"><pre><span></span><code><span class="n">gain_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span>
    <span class="s1">&#39;q1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)],</span>
    <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)],</span>
    <span class="s1">&#39;q3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
    <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()],</span>
    <span class="s1">&#39;sd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
    <span class="s1">&#39;missing&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()]</span>
<span class="p">})</span>
<span class="n">gain_summary</span>
</code></pre></div>
<p>平均利得は約5分ですが、最大は109分にもなります！</p>
<p><code>gain</code>は数値変数なので、ヒストグラムを使ってその分布を可視化できます：</p>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;steelblue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gain変数のヒストグラム&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Gain（分）&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;頻度&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p>結果のヒストグラムは、先ほど計算した要約統計量とは異なる視点で<code>gain</code>変数を提供します。例えば、ほとんどの<code>gain</code>値はちょうど0付近にあることに注意してください。</p>
<p>pandasでは、同時に複数の新しい変数を作成することもできます。さらに、新しく作成した変数を参照することもできます：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span><span class="s1">&#39;dep_delay&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">flights</span><span class="p">[</span><span class="s1">&#39;arr_delay&#39;</span><span class="p">]</span>
<span class="n">flights</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span><span class="s1">&#39;air_time&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">60</span>
<span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain_per_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[</span><span class="s1">&#39;gain&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">flights</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span>
</code></pre></div>
<p><strong>学習チェック：</strong></p>
<p><code>flights</code>の<code>gain</code>変数の正の値は何に対応していますか？負の値はどうですか？ゼロ値は？</p>
<p><code>dep_time</code>から<code>sched_dep_time</code>を引き、到着についても同様にして<code>dep_delay</code>と<code>arr_delay</code>列を作成できますか？コードを試して、結果と実際に<code>flights</code>に表示されるものとの違いを説明してください。</p>
<h2 id="_9">行の並べ替え</h2>
<p>最も一般的に行われるデータラングリングタスクの1つは、データフレームの行を何らかの変数の値に基づいて並べ替えることです。pandasの<code>sort_values()</code>メソッドを使用すると、指定した変数の値に従ってデータフレームの行をソート/並べ替えることができます。</p>
<p>2013年にニューヨーク市から出発するすべての国内線の最も頻繁な目的地空港を決定したいとします：</p>
<div class="highlight"><pre><span></span><code><span class="n">freq_dest</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;dest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;num_flights&#39;</span><span class="p">)</span>
<span class="n">freq_dest</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>デフォルトでは、結果の<code>freq_dest</code>データフレームの行は<code>dest</code>アルファベット順に並べられています。代わりに、フライト数（<code>num_flights</code>）の最も多いものから最も少ないものへと並べ替えたいとします：</p>
<div class="highlight"><pre><span></span><code><span class="n">freq_dest</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;num_flights&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>しかし、これは望ましい結果の逆です。行は最も頻度の低い目的地空港が最初に表示されるように並べられています。これは、<code>sort_values()</code>がデフォルトで常に行を昇順に並べるためです。順序を「降順」に切り替えるには、<code>ascending=False</code>パラメータを使用します：</p>
<div class="highlight"><pre><span></span><code><span class="n">freq_dest</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;num_flights&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<h2 id="_10">データフレームの結合</h2>
<p>別の一般的なデータ変換タスクは、2つの異なるデータセットを「結合」または「マージ」することです。例えば、<code>flights</code>データフレームでは、変数<code>carrier</code>が異なるフライトのキャリアコードを一覧表示しています。「UA」や「AA」に対応する航空会社名は推測しやすいかもしれませんが（ユナイテッド航空とアメリカン航空）、「VX」、「HA」、「B6」のコードはどの航空会社でしょうか？この情報は別のデータフレーム<code>airlines</code>に記載されています。</p>
<div class="highlight"><pre><span></span><code><span class="n">airlines</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p><code>airlines</code>では、<code>carrier</code>はキャリアコード、<code>name</code>は航空会社の正式名称です。この表を使用すると、「VX」、「HA」、「B6」がそれぞれバージンアメリカ、ハワイアン航空、ジェットブルーに対応していることがわかります。しかし、この情報をすべて2つの別々のデータフレームではなく、1つのデータフレームにまとめられたら便利ではないでしょうか？<code>flights</code>と<code>airlines</code>データフレームを「結合」することでこれを実現できます。</p>
<p><code>flights</code>データフレームの変数<code>carrier</code>の値は、<code>airlines</code>データフレームの変数<code>carrier</code>の値と一致することに注意してください。この場合、変数<code>carrier</code>を2つのデータフレームの行を一致させるための「キー変数」として使用できます。</p>
<h3 id="_11">一致する「キー」変数名</h3>
<p><code>flights</code>と<code>airlines</code>の両方のデータフレームで、行を結合/マージ/一致させたいキー変数は同じ名前です：<code>carrier</code>。<code>merge()</code>メソッドを使用して2つのデータフレームを結合し、変数<code>carrier</code>によって行が一致するようにしましょう：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights_joined</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">airlines</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;carrier&#39;</span><span class="p">)</span>
<span class="n">flights_joined</span><span class="p">[[</span><span class="s1">&#39;carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p><code>flights</code>と<code>flights_joined</code>データフレームは、<code>flights_joined</code>に<code>name</code>という追加の変数があることを除いて同一です。<code>name</code>の値は、<code>airlines</code>データフレームに示されている航空会社名に対応しています。</p>
<h3 id="_12">異なる「キー」変数名</h3>
<p>2013年にニューヨーク市から出発するすべての国内線の目的地に興味があり、「これらの空港はどの都市にありますか？」、「『ORD』はオーランドですか？」、「『FLL』はどこですか？」などの質問をします。</p>
<p><code>airports</code>データフレームには各空港の空港コードが含まれています：</p>
<div class="highlight"><pre><span></span><code><span class="n">airports</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>しかし、<code>airports</code>と<code>flights</code>の両方のデータフレームを見ると、空港コードは異なる名前の変数にあることがわかります。<code>airports</code>では空港コードは<code>faa</code>にありますが、<code>flights</code>では空港コードは<code>origin</code>と<code>dest</code>にあります。</p>
<p>空港コードでこれら2つのデータフレームを結合するために、<code>merge</code>操作では<code>left_on</code>と<code>right_on</code>パラメータを使用します：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights_with_airport_names</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">airports</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;dest&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;faa&#39;</span><span class="p">)</span>
<span class="n">flights_with_airport_names</span><span class="p">[[</span><span class="s1">&#39;dest&#39;</span><span class="p">,</span> <span class="s1">&#39;faa&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>ニューヨーク市から各目的地への便数を計算するパイプラインを構築し、各目的地空港に関する情報も含めましょう：</p>
<div class="highlight"><pre><span></span><code><span class="n">named_dests</span> <span class="o">=</span> <span class="p">(</span><span class="n">flights</span>
               <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;dest&#39;</span><span class="p">)</span>
               <span class="o">.</span><span class="n">size</span><span class="p">()</span>
               <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;num_flights&#39;</span><span class="p">)</span>
               <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;num_flights&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
               <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">airports</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;dest&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;faa&#39;</span><span class="p">)</span>
               <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;airport_name&#39;</span><span class="p">})</span>
              <span class="p">)</span>
<span class="n">named_dests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<p>知らなかった場合、「ORD」はシカゴ・オヘア空港の空港コードで、「FLL」はフロリダ州フォートローダーデールの主要空港です。これは<code>airport_name</code>変数で確認できます。</p>
<h3 id="_13">複数の「キー」変数</h3>
<p><em>複数のキー変数</em>で2つのデータフレームを結合したい場合もあります。例えば、<code>flights</code>と<code>weather</code>データフレームを結合するには、1つ以上のキー変数が必要です：<code>year</code>、<code>month</code>、<code>day</code>、<code>hour</code>、<code>origin</code>。これは、これら5つの変数の組み合わせが<code>weather</code>データフレーム内の各観測単位を一意に識別するためです：3つのNYC空港それぞれの毎時間の天気記録。</p>
<p>キー変数のリストを指定してこれを実現します：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># flights_weather_joined = flights.merge(weather, </span>
<span class="c1">#                                       on=[&#39;year&#39;, &#39;month&#39;, &#39;day&#39;, &#39;hour&#39;, &#39;origin&#39;])</span>
<span class="c1"># flights_weather_joined.head()</span>
</code></pre></div>
<p><strong>学習チェック：</strong></p>
<p><code>flights</code>と<code>weather</code>を結合する（または各フライトと時間ごとの天気値を一致させる）とき、なぜ<code>hour</code>だけではなく、<code>year</code>、<code>month</code>、<code>day</code>、<code>hour</code>、<code>origin</code>のすべてで結合する必要があるのですか？</p>
<p>2013年のNYCからの上位10の目的地について何が驚きましたか？</p>
<h3 id="_14">正規形</h3>
<p><code>nycflights13</code>パッケージに含まれるデータフレームは、データの冗長性を最小限に抑える形式になっています。例えば、<code>flights</code>データフレームは航空会社の<code>carrier</code>コードのみを保存し、航空会社の実際の名前は含まれていません。例えば、<code>flights</code>の最初の行には<code>carrier</code>が<code>UA</code>と等しいですが、航空会社名「United Air Lines Inc.」は含まれていません。</p>
<p>航空会社名は<code>airlines</code>データフレームの<code>name</code>変数に含まれています。<code>flights</code>に航空会社名を含めるには、これら2つのデータフレームを次のように結合できます：</p>
<div class="highlight"><pre><span></span><code><span class="n">joined_flights</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">airlines</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;carrier&#39;</span><span class="p">)</span>
<span class="n">joined_flights</span><span class="p">[[</span><span class="s1">&#39;carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>これらのデータフレームの間で一方を他方に関連付けるための共通の<em>キー</em>があるため、この結合を行うことができます：<code>flights</code>と<code>airlines</code>の両方のデータフレームの<code>carrier</code>変数です。キー変数は多くの場合、前述の<em>識別変数</em>です。</p>
<p>これはデータの<em>正規形</em>と呼ばれる重要な特性です。情報を失うことなくデータフレームをより冗長性の少ないテーブルに分解するプロセスは<em>正規化</em>と呼ばれます。詳細は<a href="https://en.wikipedia.org/wiki/Database_normalization">Wikipedia</a>で確認できます。</p>
<p>pandasと<a href="https://en.wikipedia.org/wiki/SQL">SQL</a>はどちらもこのような<em>正規形</em>を使用します。これらが共通点を持っているため、どちらかのツールを学ぶと、もう一方も非常に簡単に学ぶことができます。</p>
<p><strong>学習チェック：</strong></p>
<p>正規形のデータの利点は何ですか？欠点は何ですか？</p>
<h2 id="_15">その他の操作</h2>
<p>他にも便利なデータラングリング操作があります：</p>
<ul>
<li>変数/列のサブセットのみを選択する</li>
<li>変数/列の名前を変更する</li>
<li>変数の上位n個の値のみを返す</li>
</ul>
<h3 id="_16">変数の選択</h3>
<p><img alt="列の選択の図" src="https://d33wubrfki0l68.cloudfront.net/e829fb346c6d34d9a19c8a01b636ecb2c075c862/ae23a/images/cheatsheets/select.png" /></p>
<p><code>nycflights13</code>パッケージの<code>flights</code>データフレームには異なる19の変数が含まれています。これらの19変数の名前は<code>flights.columns</code>で確認できます：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>
<p>ただし、これら19の変数のうち、<code>carrier</code>と<code>flight</code>の2つだけが必要だとします。これらの2つの変数を選択できます：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights</span><span class="p">[[</span><span class="s1">&#39;carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;flight&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>この関数を使うと、関心のある変数だけに焦点を絞ることができるため、大きなデータセットの探索が容易になります。</p>
<p>代わりに、特定の変数を削除、つまり選択解除したい場合を考えてみましょう。例えば、<code>flights</code>データフレームの変数<code>year</code>について考えてみましょう。この変数は常に<code>2013</code>なので、実際には「変数」ではありません。この変数をデータフレームから削除したいとします。<code>drop()</code>メソッドを使用して<code>year</code>を選択解除できます：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights_no_year</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">flights_no_year</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>
<p>列/変数を選択する別の方法は、列の範囲を指定することです：</p>
<div class="highlight"><pre><span></span><code><span class="n">flight_arr_times</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span><span class="s1">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flights</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;arr_time&#39;</span><span class="p">:</span><span class="s1">&#39;sched_arr_time&#39;</span><span class="p">])</span>
<span class="n">flight_arr_times</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<p>これにより、<code>month</code>から<code>day</code>までの列と、<code>arr_time</code>から<code>sched_arr_time</code>までの列がすべて選択され、残りは削除されます。</p>
<p>変数の選択は、列の順序を変更するためにも使用できます。例えば、<code>year</code>、<code>month</code>、<code>day</code>変数の直後に<code>hour</code>、<code>minute</code>、<code>time_hour</code>変数を表示したいとします（残りの変数は破棄しません）：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights_reorder</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;time_hour&#39;</span><span class="p">]</span> <span class="o">+</span> 
                          <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">flights</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;time_hour&#39;</span><span class="p">]]]</span>
<span class="n">flights_reorder</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>
<p>最後に、<code>startswith()</code>、<code>endswith()</code>、<code>contains()</code>などのメソッドを使用して、それらの条件に一致する変数/列を選択できます：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># &quot;a&quot;で始まる列を選択</span>
<span class="n">flights</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">flights</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># &quot;delay&quot;で終わる列を選択</span>
<span class="n">flights</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">flights</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;delay&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># &quot;time&quot;を含む列を選択</span>
<span class="n">flights</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">flights</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<h3 id="_17">変数の名前変更</h3>
<p>もう一つの便利な関数は<code>rename()</code>で、これは変数の名前を変更します。<code>dep_time</code>と<code>arr_time</code>のみに焦点を当て、<code>dep_time</code>と<code>arr_time</code>をそれぞれ<code>departure_time</code>と<code>arrival_time</code>に変更したいとします：</p>
<div class="highlight"><pre><span></span><code><span class="n">flights_time_new</span> <span class="o">=</span> <span class="n">flights</span><span class="p">[[</span><span class="s1">&#39;dep_time&#39;</span><span class="p">,</span> <span class="s1">&#39;arr_time&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dep_time&#39;</span><span class="p">:</span> <span class="s1">&#39;departure_time&#39;</span><span class="p">,</span> <span class="s1">&#39;arr_time&#39;</span><span class="p">:</span> <span class="s1">&#39;arrival_time&#39;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">flights_time_new</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<h3 id="n">変数の上位n個の値</h3>
<p>変数の上位n個の値も<code>nlargest()</code>メソッドを使用して返すことができます。例えば、前の節の例を使用して、上位10の目的地空港のデータフレームを返すことができます：</p>
<div class="highlight"><pre><span></span><code><span class="n">top_10_dests</span> <span class="o">=</span> <span class="n">named_dests</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;num_flights&#39;</span><span class="p">)</span>
<span class="n">top_10_dests</span>
</code></pre></div>
<p>さらに、これらの結果を<code>num_flights</code>の降順に並べ替えることもできます：</p>
<div class="highlight"><pre><span></span><code><span class="n">top_10_dests</span> <span class="o">=</span> <span class="n">named_dests</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;num_flights&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;num_flights&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">top_10_dests</span>
</code></pre></div>
<p><strong>学習チェック：</strong></p>
<p><code>flights</code>から<code>dest</code>、<code>air_time</code>、<code>distance</code>の3つの変数すべてを選択する方法は何ですか？これを少なくとも3つの異なる方法で行うコードを示してください。</p>
<p><code>startswith()</code>、<code>endswith()</code>、<code>contains()</code>を使用して<code>flights</code>データフレームから列を選択するにはどうすればよいですか？3つの異なる例を示してください：1つは<code>startswith()</code>用、1つは<code>endswith()</code>用、1つは<code>contains()</code>用。</p>
<p>データフレームに対して<code>select</code>関数を使用したい理由は何ですか？</p>
<p>2013年にニューヨーク市から出発した到着遅延が最も大きい上位5つの空港を示す新しいデータフレームを作成してください。</p>
<h2 id="_18">結論</h2>
<h3 id="_19">要約表</h3>
<p>データラングリング操作を表にまとめてみましょう：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>データラングリング操作</th>
</tr>
</thead>
<tbody>
<tr>
<td>フィルタリング</td>
<td>データフレームの既存の行から条件に基づいてサブセットを選択する</td>
</tr>
<tr>
<td>要約</td>
<td>1つ以上の列/変数を要約統計量で要約する</td>
</tr>
<tr>
<td>グループ化</td>
<td>行をグループ化する。異なるグループごとに個別の要約統計量を計算するためにグループ化と要約を組み合わせることができる</td>
</tr>
<tr>
<td>変数作成</td>
<td>既存の列/変数から新しい列/変数を作成する</td>
</tr>
<tr>
<td>並べ替え</td>
<td>特定の変数の値に基づいてデータフレームの行を昇順または降順に並べ替える</td>
</tr>
<tr>
<td>結合</td>
<td>「キー」変数に沿って一致させることにより、別のデータフレームとデータフレームを結合する</td>
</tr>
</tbody>
</table>
<p><strong>学習チェック：</strong></p>
<p>新たに習得したデータラングリングスキルをテストしてみましょう！</p>
<p>航空業界における旅客航空会社のキャパシティの指標は<a href="https://en.wikipedia.org/wiki/Available_seat_miles">提供座席マイル（available seat miles）</a>です。これは、利用可能な座席数に飛行するマイル数またはキロメートル数を掛け、すべてのフライトにわたって合計したものです。</p>
<p>例えば、航空機に4つの座席があり、200マイル移動する場合、提供座席マイルは4 × 200 = 800です。</p>
<p>この考えを拡張すると、航空会社が10席の航空機を使用して500マイル飛行する便を2便と、20席の航空機を使用して1000マイル飛行する便を3便持っていた場合、提供座席マイルは2 × 10 × 500 + 3 × 20 × 1000 = 70,000座席マイルとなります。</p>
<p><code>nycflights13</code>パッケージに含まれるデータセットを使用して、各航空会社の提供座席マイルを降順に計算してください。必要なすべてのデータラングリングステップを完了した後、結果のデータフレームには16行（各航空会社に1行）と2列（航空会社名と提供座席マイル）が含まれるはずです。</p>
<p>ヒント：
1. <strong>重要</strong>: 何をしているのかに非常に自信がない限り、すぐにコーディングを始めないことが価値があります。むしろ、最初に必要なすべてのデータラングリングステップを紙に概略的に書き出し、正確なコードではなく、高レベルの<em>疑似コード</em>を使用して行うことを明確にします。これにより、何をしようとしているのか（アルゴリズム）と、それをどのように行うか（pandasコードの記述）を混同することがなくなります。
2. <code>View()</code>関数を使用してすべてのデータセットをよく見てください：<code>flights</code>、<code>weather</code>、<code>planes</code>、<code>airports</code>、<code>airlines</code>から提供座席マイルの計算に必要な変数を特定します。
3. 様々なデータセットがどのように結合できるかを示す図も役立ちます。
4. 表のデータラングリング操作をツールボックスとして考えてください！</p>
<h3 id="_20">その他のリソース</h3>
<p><a href="https://moderndive.com/C-appendixC.html">付録C</a>では、学生プロジェクトでよく遭遇するデータラングリングの「ヒントとコツ」のページを提供しています。例えば：</p>
<ul>
<li>欠損値の扱い</li>
<li>棒グラフの棒の並べ替え</li>
<li>軸上のお金の表示</li>
<li>セル内の値の変更</li>
<li>数値変数をカテゴリー変数に変換する</li>
<li>比率の計算</li>
<li>%、カンマ、$の扱い</li>
</ul>
<p>しかし、可能なすべてのデータラングリングの質問をカバーするヒントとコツのページを提供するのは長すぎて役に立ちません。pandasパッケージのデータラングリング機能をさらに活用したい場合は、pandasの公式ドキュメントや「Python for Data Analysis」（Wes McKinney著）を確認することをお勧めします。</p>
<h3 id="_21">次に何が来るか？</h3>
<p>これまで、データフレームに保存されたデータの探索、可視化、加工を行ってきました。これらのデータフレームは表計算型の長方形形式で保存されていました：観測に対応する一定数の行と、これらの観測を説明する一定数の列からなる形です。</p>
<p>次の第4章では、表計算型の長方形形式でデータを表現する2つの方法があることがわかります：(1)「ワイド」形式と(2)「トール/ナロー」形式です。トール/ナロー形式は、Rユーザーの間では<em>「整然データ（tidy）」</em>形式とも呼ばれています。「整然」と非「整然」形式のデータの区別は微妙ですが、私たちのデータサイエンス作業に大きな影響を与えます。これは、データ可視化のための<code>seaborn</code>パッケージやデータラングリングのための<code>pandas</code>パッケージを含む、この本で使用されるほぼすべてのパッケージが、すべてのデータフレームが「整然」形式であることを前提としているためです。</p>
<p>さらに、これまでは主にPythonライブラリに保存されているデータの探索、可視化、加工を行ってきました。しかし、Microsoft Excel、Google Sheets、「カンマ区切り値」（CSV）ファイルに保存されているデータを分析したい場合はどうでしょうか？第4章では、pandasを使用してこのデータをPythonにインポートする方法も紹介します。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  ページトップへ戻る
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 - 2025 Tomoshige Nakamura
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.expand", "navigation.path", "navigation.indexes", "navigation.sections", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>